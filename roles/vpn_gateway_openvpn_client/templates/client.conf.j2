#
# THIS FILE IS GENERATED BY ANSIBLE
#
client
remote {{ vpn_gateway_openvpn_client_remote }} 443
verify-x509-name {{ vpn_gateway_openvpn_client_x509_name }} name
remote-cert-tls server

dev tun
proto tcp
resolv-retry infinite
nobind

auth SHA256
cipher AES-256-GCM
persist-key
persist-tun

tls-timeout 30
tls-version-min 1.2
key-direction 1

log openvpn.log
verb 3

script-security 2
setenv PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
up "/etc/openvpn/scripts/update-azure-private-dns.sh -a up -u {{ vpn_gateway_openvpn_client_sp_username }} -p {{ vpn_gateway_openvpn_client_sp_password }} -t {{ vpn_gateway_openvpn_client_tenant }} -g {{ vpn_gateway_openvpn_client_rg }} -z {{ vpn_gateway_openvpn_client_zone_name }} -r {{ ansible_facts['hostname'] }}"
up-restart
down "/etc/openvpn/scripts/update-azure-private-dns.sh -a down -u {{ vpn_gateway_openvpn_client_sp_username }} -p {{ vpn_gateway_openvpn_client_sp_password }} -t {{ vpn_gateway_openvpn_client_tenant }} -g {{ vpn_gateway_openvpn_client_rg }} -z {{ vpn_gateway_openvpn_client_zone_name }} -r {{ ansible_facts['hostname'] }}"
down-pre


# P2S CA root certificate
ca /etc/openvpn/client/{{ vpn_gateway_openvpn_client_name }}-ca.crt

# Pre Shared Key
tls-auth /etc/openvpn/client/{{ vpn_gateway_openvpn_client_name }}.tls 1

# P2S client certificate
# Please fill this field with a PEM formatted client certificate
# Alternatively, configure 'cert PATH_TO_CLIENT_CERT' to use input from a PEM certificate file.
cert /etc/openvpn/client/{{ vpn_gateway_openvpn_client_name }}.crt

# P2S client certificate private key
# Please fill this field with a PEM formatted private key of the client certificate.
# Alternatively, configure 'key PATH_TO_CLIENT_KEY' to use input from a PEM key file.
key /etc/openvpn/client/{{ vpn_gateway_openvpn_client_name }}.key
